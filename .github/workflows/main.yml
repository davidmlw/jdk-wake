name: CI

on:
  push:
    branches:
      - master
  pull_request:
  watch:
    types: [ started ]

jobs:

  build:

    runs-on: ubuntu-latest

    if: github.actor == github.event.repository.owner.login

    steps:

    - name: Checkout
      uses: actions/checkout@v2

    - name: Prepare workspace
      uses: sifive/wit/actions/wit@master
      with:
        command: init
        arguments: |
          workspace
          -a git@github.com:chipsalliance/rocket-chip.git
        force_github_https: true

    - name: Build workspace
      uses: ./
      with:
        arguments: -x rocketchipScalaModule.compileScalaModule
##
##   release:
##     name: Create Release
##     runs-on: ubuntu-latest
##     steps:
##       - name: Checkout code
##         uses: actions/checkout@v2
##       - name: Create Release
##         id: create_release
##         uses: actions/create-release@v1
##         env:
##           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # This token is provided by Actions, you do not need to create your own token
##         with:
##           tag_name: ${{ github.ref }}
##           release_name: Release ${{ github.ref }}
##           body: |
##             Init wake jdk
##           draft: false
##           prerelease: false
##
